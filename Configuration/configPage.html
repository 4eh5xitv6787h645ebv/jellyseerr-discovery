<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Jellyseerr Discovery</title>
</head>
<body>
    <div id="JellyseerrDiscoveryConfigPage" data-role="page" class="page type-interior pluginConfigurationPage"
        data-require="emby-input,emby-button,emby-checkbox,emby-select">
        <div data-role="content">
            <div class="content-primary">
                <form id="JellyseerrDiscoveryConfigForm">
                    <div class="sectionTitleContainer flex align-items-center">
                        <h2 class="sectionTitle">Jellyseerr Discovery</h2>
                    </div>

                    <div class="verticalSection">
                        <p class="description">
                            Discover actor filmography and studio catalogs via Jellyseerr/TMDb.
                            When viewing an actor or studio in Jellyfin, you can see their complete works
                            including content not yet in your library.
                        </p>
                    </div>

                    <div class="verticalSection">
                        <h3 class="sectionTitle">General Settings</h3>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="Enabled" />
                                <span>Enable Plugin</span>
                            </label>
                            <div class="fieldDescription">
                                Enable or disable the Jellyseerr Discovery plugin.
                            </div>
                        </div>
                    </div>

                    <div class="verticalSection">
                        <h3 class="sectionTitle">Jellyseerr Connection</h3>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="JellyseerrUrl">
                                Jellyseerr URL
                            </label>
                            <input type="text" id="JellyseerrUrl" is="emby-input"
                                placeholder="http://jellyseerr:5055" />
                            <div class="fieldDescription">
                                The URL of your Jellyseerr server. Use the internal Docker hostname if running in Docker
                                (e.g., http://jellyseerr:5055).
                            </div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="JellyseerrApiKey">
                                Jellyseerr API Key
                            </label>
                            <input type="password" id="JellyseerrApiKey" is="emby-input"
                                placeholder="API Key" />
                            <div class="fieldDescription">
                                Your Jellyseerr API key. Find this in Jellyseerr Settings > General > API Key.
                            </div>
                        </div>

                        <div class="inputContainer">
                            <button type="button" is="emby-button" class="raised button-submit"
                                id="TestConnection">
                                <span>Test Connection</span>
                            </button>
                            <span id="TestResult" style="margin-left: 10px;"></span>
                        </div>
                    </div>

                    <div class="verticalSection">
                        <h3 class="sectionTitle">Content Filtering</h3>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="MaxResults">
                                Maximum Results
                            </label>
                            <input type="number" id="MaxResults" is="emby-input" min="10" max="500"
                                placeholder="50" />
                            <div class="fieldDescription">
                                Maximum number of results to return per query (10-500). Higher values may slow down responses.
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="IncludeLibraryItems" />
                                <span>Include items already in library</span>
                            </label>
                            <div class="fieldDescription">
                                When enabled, shows all results including items already available in your library.
                                When disabled, only shows items that can be requested.
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="ExcludeTalkShows" />
                                <span>Exclude talk shows &amp; award shows</span>
                            </label>
                            <div class="fieldDescription">
                                Filter out talk shows, late night shows, award shows, and similar content
                                (e.g., "The Late Show", "The Kelly Clarkson Show", "Tony Awards").
                            </div>
                        </div>
                    </div>

                    <div class="verticalSection">
                        <h3 class="sectionTitle">Person Page Settings</h3>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="ShowPersonDiscovery" />
                                <span>Enable discovery on person pages</span>
                            </label>
                            <div class="fieldDescription">
                                Show filmography discovery sections when viewing actor/director pages.
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="ShowCastCredits" />
                                <span>Show Appearances section</span>
                            </label>
                            <div class="fieldDescription">
                                Show the "Appearances" section with movies/shows where the person acted.
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="ShowCrewCredits" />
                                <span>Show Crew section</span>
                            </label>
                            <div class="fieldDescription">
                                Show the "Crew" section with movies/shows where the person worked behind the scenes
                                (director, writer, producer, etc.).
                            </div>
                        </div>
                    </div>

                    <div class="verticalSection">
                        <h3 class="sectionTitle">Studio Page Settings</h3>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="ShowStudioDiscovery" />
                                <span>Enable discovery on studio pages</span>
                            </label>
                            <div class="fieldDescription">
                                Show catalog discovery sections when viewing studio/network pages.
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="EnableInfiniteScroll" />
                                <span>Enable infinite scroll</span>
                            </label>
                            <div class="fieldDescription">
                                Automatically load more items as you scroll down on studio pages.
                            </div>
                        </div>
                    </div>

                    <div class="verticalSection">
                        <h3 class="sectionTitle">Card Display Options</h3>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="ShowMediaStatus" />
                                <span>Show media status badge</span>
                            </label>
                            <div class="fieldDescription">
                                Show the availability status badge (Available, Requested, Processing, etc.) on cards.
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="ShowMediaTypeBadge" />
                                <span>Show media type badge</span>
                            </label>
                            <div class="fieldDescription">
                                Show the MOVIE/SERIES badge on cards.
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="ShowRatings" />
                                <span>Show ratings</span>
                            </label>
                            <div class="fieldDescription">
                                Show the star rating below each card.
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="ShowYear" />
                                <span>Show year</span>
                            </label>
                            <div class="fieldDescription">
                                Show the release year below each card.
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="ShowRoleName" />
                                <span>Show character/role name</span>
                            </label>
                            <div class="fieldDescription">
                                Show the character name (e.g., "as Tony Stark") on person page cards.
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="ShowOverviewOnHover" />
                                <span>Show overview on hover</span>
                            </label>
                            <div class="fieldDescription">
                                Show the movie/show description when hovering over a card.
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="ShowCollectionBadge" />
                                <span>Show collection badge</span>
                            </label>
                            <div class="fieldDescription">
                                Show the collection badge (e.g., "Marvel Cinematic Universe") on movie cards.
                            </div>
                        </div>
                    </div>

                    <div class="verticalSection">
                        <h3 class="sectionTitle">Advanced</h3>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="DebugMode" />
                                <span>Enable debug mode</span>
                            </label>
                            <div class="fieldDescription">
                                Enable debug logging in the browser console for troubleshooting.
                            </div>
                        </div>
                    </div>

                    <div class="verticalSection">
                        <h3 class="sectionTitle">API Endpoints</h3>
                        <div class="description">
                            <p>The following API endpoints are available:</p>
                            <ul style="font-family: monospace; font-size: 0.9em;">
                                <li><strong>GET</strong> /JellyseerrDiscovery/person/{tmdbId} - Get actor filmography</li>
                                <li><strong>GET</strong> /JellyseerrDiscovery/person/search?name={name} - Search actor by name</li>
                                <li><strong>GET</strong> /JellyseerrDiscovery/studio/{tmdbId}?page=1 - Get studio catalog</li>
                                <li><strong>GET</strong> /JellyseerrDiscovery/studio/search?name={name}&page=1 - Search studio by name</li>
                                <li><strong>GET</strong> /JellyseerrDiscovery/network/{tmdbId}?page=1 - Get TV network catalog</li>
                                <li><strong>GET</strong> /JellyseerrDiscovery/health - Health check</li>
                            </ul>
                        </div>
                    </div>

                    <div>
                        <button is="emby-button" type="submit" class="raised button-submit block">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script type="text/javascript">
            var JellyseerrDiscoveryConfig = {
                pluginUniqueId: 'b2c3d4e5-f6a7-8901-bcde-f23456789012'
            };

            document.querySelector('#JellyseerrDiscoveryConfigPage')
                .addEventListener('pageshow', function () {
                    Dashboard.showLoadingMsg();
                    ApiClient.getPluginConfiguration(JellyseerrDiscoveryConfig.pluginUniqueId)
                        .then(function (config) {
                            // General
                            document.querySelector('#Enabled').checked = config.Enabled;
                            document.querySelector('#JellyseerrUrl').value = config.JellyseerrUrl || '';
                            document.querySelector('#JellyseerrApiKey').value = config.JellyseerrApiKey || '';

                            // Content Filtering
                            document.querySelector('#MaxResults').value = config.MaxResults || 50;
                            document.querySelector('#IncludeLibraryItems').checked = config.IncludeLibraryItems;
                            document.querySelector('#ExcludeTalkShows').checked = config.ExcludeTalkShows !== false;

                            // Person Page
                            document.querySelector('#ShowPersonDiscovery').checked = config.ShowPersonDiscovery !== false;
                            document.querySelector('#ShowCastCredits').checked = config.ShowCastCredits !== false;
                            document.querySelector('#ShowCrewCredits').checked = config.ShowCrewCredits !== false;

                            // Studio Page
                            document.querySelector('#ShowStudioDiscovery').checked = config.ShowStudioDiscovery !== false;
                            document.querySelector('#EnableInfiniteScroll').checked = config.EnableInfiniteScroll !== false;

                            // Card Display
                            document.querySelector('#ShowMediaStatus').checked = config.ShowMediaStatus !== false;
                            document.querySelector('#ShowMediaTypeBadge').checked = config.ShowMediaTypeBadge !== false;
                            document.querySelector('#ShowRatings').checked = config.ShowRatings !== false;
                            document.querySelector('#ShowYear').checked = config.ShowYear !== false;
                            document.querySelector('#ShowRoleName').checked = config.ShowRoleName !== false;
                            document.querySelector('#ShowOverviewOnHover').checked = config.ShowOverviewOnHover !== false;
                            document.querySelector('#ShowCollectionBadge').checked = config.ShowCollectionBadge !== false;

                            // Advanced
                            document.querySelector('#DebugMode').checked = config.DebugMode;

                            Dashboard.hideLoadingMsg();
                        });
                });

            document.querySelector('#JellyseerrDiscoveryConfigForm')
                .addEventListener('submit', function (e) {
                    e.preventDefault();
                    Dashboard.showLoadingMsg();

                    ApiClient.getPluginConfiguration(JellyseerrDiscoveryConfig.pluginUniqueId)
                        .then(function (config) {
                            // General
                            config.Enabled = document.querySelector('#Enabled').checked;
                            config.JellyseerrUrl = document.querySelector('#JellyseerrUrl').value;
                            config.JellyseerrApiKey = document.querySelector('#JellyseerrApiKey').value;

                            // Content Filtering
                            config.MaxResults = parseInt(document.querySelector('#MaxResults').value) || 50;
                            config.IncludeLibraryItems = document.querySelector('#IncludeLibraryItems').checked;
                            config.ExcludeTalkShows = document.querySelector('#ExcludeTalkShows').checked;

                            // Person Page
                            config.ShowPersonDiscovery = document.querySelector('#ShowPersonDiscovery').checked;
                            config.ShowCastCredits = document.querySelector('#ShowCastCredits').checked;
                            config.ShowCrewCredits = document.querySelector('#ShowCrewCredits').checked;

                            // Studio Page
                            config.ShowStudioDiscovery = document.querySelector('#ShowStudioDiscovery').checked;
                            config.EnableInfiniteScroll = document.querySelector('#EnableInfiniteScroll').checked;

                            // Card Display
                            config.ShowMediaStatus = document.querySelector('#ShowMediaStatus').checked;
                            config.ShowMediaTypeBadge = document.querySelector('#ShowMediaTypeBadge').checked;
                            config.ShowRatings = document.querySelector('#ShowRatings').checked;
                            config.ShowYear = document.querySelector('#ShowYear').checked;
                            config.ShowRoleName = document.querySelector('#ShowRoleName').checked;
                            config.ShowOverviewOnHover = document.querySelector('#ShowOverviewOnHover').checked;
                            config.ShowCollectionBadge = document.querySelector('#ShowCollectionBadge').checked;

                            // Advanced
                            config.DebugMode = document.querySelector('#DebugMode').checked;

                            ApiClient.updatePluginConfiguration(JellyseerrDiscoveryConfig.pluginUniqueId, config)
                                .then(function (result) {
                                    Dashboard.processPluginConfigurationUpdateResult(result);
                                });
                        });

                    return false;
                });

            document.querySelector('#TestConnection')
                .addEventListener('click', function () {
                    var resultSpan = document.querySelector('#TestResult');
                    resultSpan.textContent = 'Testing...';
                    resultSpan.style.color = '';

                    var url = document.querySelector('#JellyseerrUrl').value;
                    if (!url) {
                        resultSpan.textContent = 'Please enter Jellyseerr URL first';
                        resultSpan.style.color = 'red';
                        return;
                    }

                    // Test the health endpoint
                    fetch(ApiClient.getUrl('JellyseerrDiscovery/health'))
                        .then(function (response) {
                            return response.json();
                        })
                        .then(function (data) {
                            if (data.JellyseerrConnected === true) {
                                resultSpan.textContent = 'Connection successful!';
                                resultSpan.style.color = 'green';
                            } else if (data.ErrorMessage) {
                                resultSpan.textContent = 'Failed: ' + data.ErrorMessage;
                                resultSpan.style.color = 'red';
                            } else {
                                resultSpan.textContent = 'Connection failed - check URL and API key';
                                resultSpan.style.color = 'red';
                            }
                        })
                        .catch(function (error) {
                            resultSpan.textContent = 'Error: ' + error.message;
                            resultSpan.style.color = 'red';
                        });
                });
        </script>
    </div>
</body>
</html>
